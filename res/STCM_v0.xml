<!-----------------------------------------------------------------------------
                          le controlflow
    23 Février
<primitive> dans component décrit le langage du script (se situant à path)
permettant de demarrer le composant à executer par l'appel (bash) de la signature.
<instance> ne fera que référencer un composant, en ajoutant (éventuellement)
des parametres à sa signature

extention de port, configport && inout (=== ajout de leurs balises)

renommage de la balise <impl> de primitive en <primitive> (cohérence)
renommage de 'type' dans <primitive> en 'lang' (cohérence)

setPort servira aussi à unsetPort, d'ou sa non existence dans l'UML
les [] correspondent aux ajouts prévus pour la V2

? le set=string dans inport
? expr dans cond
------------------------------------------------------------------------------->
stcmassembly ::= <stcmassembly> declaration? instruction? </stcmassembly>
<!----------------------------------------------------------------------------->
declaration ::= <declare> component* instance* configport? </declare>
<!----------------------------------------------------------------------------->
component ::= <component name=string> port? attribute* primitive </component>

port ::= <port> inport* | outport* [| clientport | serverport] </port>

inport ::= <inport name=string type=string (set=string)?/>
outport ::= <outport name=string type=string/>
[ clientport ::= <clientport name=string type=string (set=string)?/> ]
[ serverport ::= <serverport name=string type=string/> ]

attribute ::= <attribute name=string type=string (set=string)?/>

primitive ::= <primitive lang=string path=string signature=string/>
<!----------------------------------------------------------------------------->
instance ::= <instance name=string componentRef=string parameters=string/>
<!----------------------------------------------------------------------------->
configport ::= <configport> inout [| clientserver] </configport>

inout ::= <inout> setPort* | unsetPort* </inout>
setPort ::= <setPort in=string out=string/>
unsetPort ::= <unsetPort in=string (out=string)?/>

[ clientserver ::= <clientserver> setRemotePort* | unsetRemotePort* </clientserver> ]
[ setRemotePort ::= <setRemotePort client=string server=string/> ]
[ unsetRemotePort ::= <unsetRemotePort client=string (server=string)?/> ]
<!----------------------------------------------------------------------------->
instruction ::= <instruction> createInstance|exectask|configport|seq|if| dag </instruction>

createInstance ::= <createInstance name=string componentRef=string PATH=string signature=string/>

exectask ::= <exectask nameInstance=string/>

seq ::= <sequence name=string> port? attribute* declaration instruction+ </sequence>

if ::= <if name=string> port* attribute* declaration condition then else?</if>
condition ::= <condition> expr </condition>
then ::= <then> stcmassembly </then>
else ::= <else> stcmassembly </else>



<!-----------------------------------------------------------------------------
--------------------------------- TYPES ---------------------------------------
------------------------------------------------------------------------------>
null ::= null
string ::= "trivial"
boolean ::= 'true' | 'false'
integer ::= [0-9]+
numeric ::= [0-9]*\.[0-9]+
Array<Type> ::= {value1, value2, ...}



<!----------------------------------------------------------------------------->
<!------------------------------ EXEMPLE -------------------------------------->
<!----------------------------------------------------------------------------->
<stcmassembly> <!-- declaration? instruction? -->
  <declare> <!-- component* instance* configport? -->
    <component name=string> <!-- port* attribute* primitive-->
      <port> <!-- [inport | outport [| clientport | serverport]]* -->
        <inport name=string type=string/>
        <outport name=string type=string/>
      </port>

      <attribute name=string type=string (set=string)?/>

      <primitive type=string signature=string/>
    </component>

    <instance name=string componentRef=string parameters=string/>

    <configport> <!-- inout [| clientserver] -->
      <inout> <!-- setPort* | unsetPort*  -->
        <setPort in=string out=string/>
        <unsetPort in=string (out=string)?/>
      </inout>
    </configport>
  </declare>

  <instruction> <!-- createInstance|exectask|configport|seq|if| dag -->
    <createInstance name=string componentRef=string parameters=string/>
    <exectask nameInstance=string/>

    <sequence name=string>
      <!-- port? attribute* declare instruction+ -->
    </sequence>

    <if name=string> <!--port* attribute* declaration condition then else? -->
      <condition> expr </condition>
      <then> stcmassembly </then>
      <else> stcmassembly </else>
    </if>
  </instruction>
</stcmassembly>


























<!----------------------------------------------------------------------------->
<!-- début d'un dataflow pur -->
<!----------------------------------------------------------------------------->

<!-- Un composant primitif est composé de -->
component ::=
<component name=string>
  input output attribute* primitive
</component>

<!-- std::istream en local === pipeline '|'
      un fichier à parser, tout flot de données.. -->
input ::=
<input>
  <name>string</name>
  <type>string</type>
</input>

<!-- i.e std::outstream, un fichier de log, .. -->
<output>
  <name>string</name>
  <type>string</type>
</output>

<!-- ? une liste d'arguments passés à la primitive ? -->
<attribute>
  <name>string</name>
  <type>string</type>
  (<set>string</set>)?
</attribute>

<!-- ? un executable #!/bin/bash, python, ... -->
<primitive>
  <type>string</type>
  <path>string</path>
  <signature>string</signature>
</primitive>
